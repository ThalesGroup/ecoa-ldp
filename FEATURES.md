# LDP Features

## Supported environment

**Linux** is the only supported environment for the LDP:

* for the execution of the code generator,
* for the execution of the resulting ECOA application.

The LDP is developed and tested on Linux Fedora 33 on x86-64 architecture.

The LDP should be compatible with most Linux distributions, although this is not
guaranteed and may require some adaptations by the user.

Contributions are welcome for adaptations on Linux variants, and portability enhancements.

**gcc** is the required C compiler, and **make** is required as a build tool.

A **Java** JRE and **Ant** are required to run the generator. See the [user documentation](USAGE.md) for details.


## Supported Standards

The LDP supports the following elements of the **[ECOA Architecture Specification, preliminary version AS7]**.

  * Core Standard (except [features listed below](#non-supported-elements))
    * Some of the supported features are:
      * Instanciation of components
      * Component instance properties
      * Component lifecycle states
      * Communication mechanisms: Event, Request-Response, Versioned Data
      * Composite components
      * Sync and async request-responses
      * Immediate and deferred request-responses
      * Notifying Versioned Data
      * Triggers
      * Periodic Trigger Manager
      * External components
      * attribute `fifoSize` in assemblies (see [FIFO queues sizes](#fifo-queues-sizes) below)
    * The following features are supported, but experimental:
      * Multiple executables in an application (make single-executable applications if possible: they are easier to run and to debug)
      * WarmStart Context. API is implemented, but nothing is memorized by the infrastructure. 

  * Standard Options
    * OPTION INT64
    * OPTION SUPERVISION (with restrictions; [see below](#non-supported-elements))
  * Standard Extensions
    * None

## Supported Language Bindings

In ECOA, each component is developed in a given programming language; but an application may combine
several languages.

The generic description of the software interface (or API) between a component and its container,
for a given programming language, is called a _language binding_.

For each supported programming language, a _reference language binding_ is defined, and _extra language bindings_ may be defined.

The LDP supports only the C programming language, with the following language bindings:

* **ECOA C Language Binding I07**
  * This is the reference binding of the ECOA standard.
  * This binding is compatible with previous versions of the standard (up to AS6).
  * To use it, set `APIType="ECOA_C"` in the implementation file of the component.

* **SOFTARC C Language Binding I07**
  * This is an extra binding, defined by Thales.
  * This is the default binding if _APIType_ is not specified.
  * To use it, set `APIType="SOFTARC_C"` in the implementation file of the component.

The attribute _APIVersion_ in implementation files is ignored, as only one version of each binding is supported.

### Interoperability between different bindings

Components using different bindings can be deployed in the same application, the same
executable, and in the same task.

### Compiler requirements

The technical code generated by the LDP is in C Language, conforming to ISO 99 with GNU extensions.

The compiler *gcc* shall be used, with option `-std=gnu99`.


## Non-supported elements

The following features are **not** supported presently, but could be added in future evolutions of the LDP:

* "bin-desc": using components delivered in binary form
* OPTION COMM PORTS: application communication ports, external operations (no <external_io> section shall be present in the deployment;
  external operations may appear in the assembly, but they will be ignored)
* OPTION SUPERVISION: supervision of executables is not supported (starting/stopping/querying state/querying names)
* OPTION SUPERVISION: conditional links (elements `<when>` in the assembly) and supervision variables
* OPTION DYNAMIC TRIGGER: Dynamic Trigger Manager 
* OPTION UINT64

The following features are not supported, and they are not considered as consistent with the objectives of the LDP,
so they will probably never be added:

* task priorities
* attribute `uncontrolledAccess` on Versioned Data links (always considered false)
* attributes `activating` and `callbackActivating` in assemblies (always considered true)
* driver components


## Limitations

### Data size limits

* The maximum total size for the parameters of a single operation (event, data, or request-response) is 256 kilobytes.

### FIFO queues sizes

When a component sends an information to another component using an operation  (event, data, or request-response),
the receiving component is not always ready to process it instantaneoulsy, so the information is stored in a queue, waiting to be processed.
The maximum capacity of these queues is defined according to the ECOA Standard by the attributes `fifoSize` in the assembly, for each
operation link.

In the LDP, the logical FIFO queues (defined on an operation link basis) are grouped into physical queues.
There is one physical queue for the all executable, where all the input operations are received. This physical queue is a Unix-domain socket for local interprocess communication.
Therefore, the maximum size corresponds to the size of the socket SARC_socket_out. Its size is, at least, the sum of the size of each operationLink multiplied by 
the size of each fifoSize defined. By default, fifoSize is 8 in each operationLink. However, the size can not exceed the value specified in the file /proc/sys/net/core/wmem_max.
If you want to increase more than this value, you have to modify this file with the command : ```sudo sysctl net.core.wmem_max=X```

### External components

An external component has an additional thread, the external thread, that is specific to the component instance and entirely manage by the user. 
Container functions are _not_ callable from the external thread, except: 
* 1/ access to versioned data operations
* 2/ sending event operations

The container function `stop_external_thread` is not supported. Once started, the external thread of a component cannot be stopped.

### Real-time

_Task priorities_ (attribute `relativePriority` in deployments) are not taken into account. 
The ordinary Linux scheduling policy (SCHED_OTHER) is always used.
No special privilege is needed on the Linux system to run the application.

### Automatic component startup

Components can be initialized and started automatically when the executables start, by using attribute `start_mode` in the deployment.

The default value is `NONE` (no auto start); in this case the components shall be initialized and started by
scripting commands (e.g. `Init *` and `Start *`).

The value `FAST` starts all components in no particular order.

The value `SYNCHRONIZED` is not supported by the LDP and is considered equivalent to `FAST`.


## Checks performed by the LDP

The objective of the LDP is not to be a complete verification tool for the compliance of ECOA models.

Nevertheless, when generating technical code, it performs the following checks:

* XSD validation
* Operations signature compatibilty check: if in the assembly, several operations are connected with a link,
  but their parameters have a different structure, an error is raised and code generation fails.


---

[ECOA Architecture Specification, preliminary version AS7]:  https://www.ecoa.technology/public_draft_specifications.html
